对接协议
=================
文档目的
-----------------------------------------
本文档定义了需求方合作伙伴以API 方式对接Adxing广告行对接规范。以及使用
Tracking 展示、点击监测的数据对接规范。
Adxing广告行和媒体 之间的实时交互，使用标准 HTTP 协议、protocol buffers 格
式进行交互。您可以通过http://code.google.com/p/protobuf 获取最新的
protocol buffers 技术支持。
具体的 protocol buffers 的格式定义，请查看 ``adxing-for-seller.proto`` 。

文档范围
-----------------------------------------
本文档范围包括描述媒体发送请求到Adxing服务器，Adxing服务器返回广告响应到媒体的数据交互。

API 通用认证
-----------------------------------------
.. warning::  等待补充


执行流程说明
-----------------------------------------
.. warning::  补充图片

接口定义
-----------------------------------------
请求URL 参考RESTful 风格，请求方式为POST，约定了使用的协议、域名、版本，详
细定义如下：
https://api.example.com/ <API_VERSION>/req_ad
其中:

-1. 协议: 必须使用HTTPS（开发阶段HTTP）。

-2. API_VERSION: 版本号,当前版本号码为 v1。

*注：api 支持protobuf、json 等格式的请求/响应数据，使用时需要设置对应的
Content-Type 和Accept 为 application/x-protobuf 或 application/json*


`广告执行API`
-----------------------------------------
媒体请求字段
-----------------------------------------
即 adxing-for-seller.proto 中定义的 BidRequest 消息。具体说明如下:

**SellerRequest对象**
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
**广告请求**

+---------------+----------------+-------+-------------------------------------------------------+
| 参数名称      | 类型           | 必须  | 说明                                                  |
+===============+================+=======+=======================================================+
| id            | string         | 是    | 请求唯一标示；例如：m83390492620425                   |
+---------------+----------------+-------+-------------------------------------------------------+
| app           | Object         | 是    | 请求应用程序信息                                      |
+---------------+----------------+-------+-------------------------------------------------------+
| device        | Object         | 是    | 请求中的设备信息                                      |
+---------------+----------------+-------+-------------------------------------------------------+
| network       | Object         | 是    | 设备的网络环境                                        |
+---------------+----------------+-------+-------------------------------------------------------+
| adpos         | array object   | 是    |请求的广告位数组(目前只支持单广告位请求)               |
+---------------+----------------+-------+-------------------------------------------------------+
| test          | int            | 否    |当前请求是否是test 请求，0-正式请求（默认），1-测试请求|
+---------------+----------------+-------+-------------------------------------------------------+
| tmax          | int            | 否    | 广告竞价超时时间，单位毫秒。默认200ms                 |
+---------------+----------------+-------+-------------------------------------------------------+
| cur           | string         | 否    | 广告出价容许货币。默认“CNY”                           |
+---------------+----------------+-------+-------------------------------------------------------+


**APP 对象，应用程序**

+---------------+----------------+-------+-------------------------------------------------------+
| 参数名称      | 类型           | 必须  | 说明                                                  |
+===============+================+=======+=======================================================+
| id            | string         | 是    | 应用程序id；例如：1032                                |
+---------------+----------------+-------+-------------------------------------------------------+
| publisher     | Object         | 是    | 所属开发者                                            |
+---------------+----------------+-------+-------------------------------------------------------+

**publisher 对象，开发者信息**

+---------------+----------------+-------+-------------------------------------------------------+
| 参数名称      | 类型           | 必须  | 说明                                                  |
+===============+================+=======+=======================================================+
| id            | string         | 是    | 开发者id；例如：1232                                  |
+---------------+----------------+-------+-------------------------------------------------------+


**Device对象， 设备**

+---------------+----------------+-------+-------------------------------------------------------+
| 参数名称      | 类型           | 必须  | 说明                                                  |
+===============+================+=======+=======================================================+
| devicetype    | int            | 是    | 设备类型，1-Phone，2-Tablet；                         |
+---------------+----------------+-------+-------------------------------------------------------+
| make          | string         | 否    | 设备品牌(小写)；例如：apple                           |
+---------------+----------------+-------+-------------------------------------------------------+
| model         | string         | 否    | 设备型号(小写)；例如：iphone                          |
+---------------+----------------+-------+-------------------------------------------------------+
| hwv           | string         | 否    | 设备的硬件版本（Hardware version）；例如：            |
|               |                |       | “5S”，iPhone 5s 的“5S”                                |
+---------------+----------------+-------+-------------------------------------------------------+
| os            | string         | 否    | 操作系统，0-UNKNOWN，1-iOS，2-Android，               |
|               |                |       | 3-WindowsPhone，例如：1                               |
+---------------+----------------+-------+-------------------------------------------------------+
| osv           | string         | 否    | 操作系统版本；例如：7.0.2                             |
+---------------+----------------+-------+-------------------------------------------------------+
| size          | string         | 否    | 设备的屏幕分辨率；例如：1024x768                      |
+---------------+----------------+-------+-------------------------------------------------------+
| pixel_ratio   | int            | 否    | 设备像素比例，用于广告位size 缩放，                   |
|               |                |       | 千分位表示，默认1000                                  |
+---------------+----------------+-------+-------------------------------------------------------+
| screen_density| float          | 否    | 屏幕像素密度                                          |
+---------------+----------------+-------+-------------------------------------------------------+
| screen        | int            | 否    | 横竖屏；0-未知; 1-表示竖屏; 2-表示横屏，              |
| _orientation  |                |       | 缺省是未知                                            |
+---------------+----------------+-------+-------------------------------------------------------+
| ua            | string         | 否    | 浏览器用户代理                                        |
+---------------+----------------+-------+-------------------------------------------------------+
| ip            | string         | 否    | 手机设备IP 地址，ipv4；例如：8.8.8.8                  |
+---------------+----------------+-------+-------------------------------------------------------+
| geo           | object         | 否    | 设备地理位置信息                                      |
+---------------+----------------+-------+-------------------------------------------------------+
| ifa           | string         | 否    | IOS 设备idfa，原始值；例如：e4273e31-97a9-            |
|               |                |       |     4b29-93a8-8a99f0cea068                            |
+---------------+----------------+-------+-------------------------------------------------------+
| ifa_md5       | string         | 否    | IOS 设备idfa，md5 加密值；例如：e4273e31-97a9-        |
|               |                |       |     4b29-93a8-8a99f0cea068                            |
+---------------+----------------+-------+-------------------------------------------------------+
| android_id    | string         | 否    | android 设备的android id，原始值                      |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
| android_id_md5| string         | 否    | android 设备的android id，md5 加密值                  |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
| imei          | string         | 否    | imei 原始值                                           |
+---------------+----------------+-------+-------------------------------------------------------+
| imei_md5      | string         | 否    | imei,md5加密值                                        |
+---------------+----------------+-------+-------------------------------------------------------+
| mac           | string         | 否    | 手机设备mac原始值，大写去除冒号分隔符                 |
+---------------+----------------+-------+-------------------------------------------------------+
| mac_md5       | string         | 否    | 手机设备mac的md5加密值，大写去除冒号分隔符            |
+---------------+----------------+-------+-------------------------------------------------------+
| duid          | string         | 否    | Windows Phone 设备DUID，原始值                        |
+---------------+----------------+-------+-------------------------------------------------------+
| duid_md5      | string         | 否    | Windows Phone 设备DUID，md5加密值                     |
+---------------+----------------+-------+-------------------------------------------------------+


**geo 对象，设备地理位置信息**

+---------------+----------------+-------+-------------------------------------------------------+
| 参数名称      | 类型           | 必须  | 说明                                                  |
+===============+================+=======+=======================================================+
| lat           | float          | 否    | latitude，设备所在地理位置的纬度（小数点格式）；      |
|               |                |       | 例如：39.91667                                        |
+---------------+----------------+-------+-------------------------------------------------------+
| lon           | float          | 否    | longitude，设备所在地理位置的经度（小数点格式）；     |
|               |                |       | 例如：116.41667                                       |
+---------------+----------------+-------+-------------------------------------------------------+
| type          | int            | 否    | 经纬度信息来源 1-通过GPS 定位, 2-通过IP 地址定位      |
+---------------+----------------+-------+-------------------------------------------------------+




**network 对象，设备的网络环境**

+---------------+----------------+-------+-------------------------------------------------------+
| 参数名称      | 类型           | 必须  | 说明                                                  |
+===============+================+=======+=======================================================+
| type          | int            | 否    | 网络环境 0-UNKNOWN, 1-WIFI, 2-2G, 3-3G, 4-4G          |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
| operator      | int            | 否    | 设备的网络运营商；0-未知, 1-移动, 2-联通, 3-电信      |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
| cellular_id   | string         | 否    | 基站 ID                                               |
+---------------+----------------+-------+-------------------------------------------------------+
| wifis         | array object   | 否    | 周边 wifi 热点                                        |
+---------------+----------------+-------+-------------------------------------------------------+




**wifis 对象，wifi 热点**

+---------------+----------------+-------+-------------------------------------------------------+
| 参数名称      | 类型           | 必须  | 说明                                                  |
+===============+================+=======+=======================================================+
| mac           | string         | 否    | WIFI 热点 MAC 地址                                    |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
| rssi          | string         | 否    | 信号强度                                              |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+



**adpos 对象，广告位**

+---------------+----------------+-------+-------------------------------------------------------+
| 参数名称      | 类型           | 必须  | 说明                                                  |
+===============+================+=======+=======================================================+
| pos_id        | string         | 是    | 广告位 ID，唯一标识，从SSP 系统获取                   |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
| capacity      | int            | 否    | 广告容量(默认为 1，目前只支持单广告位请求)            |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+



广告响应字段
-----------------------------------------
即 adxing-for-seller.proto 中定义的 SellerResponse 消息。具体说明如下:

**SellerResponse对象**
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
**广告响应**

+---------------+----------------+-------+-------------------------------------------------------+
| 参数名称      | 类型           | 必须  | 说明                                                  |
+===============+================+=======+=======================================================+
| success       | bool           | 是    | 检索是否成功                                          |
+---------------+----------------+-------+-------------------------------------------------------+
| id            | string         | 是    | 返回媒体方广告请求ID ； 仅success 时为required。      |
|               |                |       | 例如：m83390492620425                                 |
+---------------+----------------+-------+-------------------------------------------------------+
| bidid         | string         | 否    | Response id，SSP 系统生成唯一id，跟踪广告请求id       |
+---------------+----------------+-------+-------------------------------------------------------+
| ads           | array object   | 是    | 广告对象；仅success 时为required。                    |
+---------------+----------------+-------+-------------------------------------------------------+
| nbr           | int            | 否    |-  检索未成功原因。                                    |
|               |                |       |                                                       |
|               |                |       | -  0-Unknown Error                                    |
|               |                |       | -  1-Technical Error                                  |
|               |                |       | -  2-Invalid Request                                  |
|               |                |       | -  3-Known Web Spider                                 |
|               |                |       | -  4-Suspected Non-Human Traffic                      |
|               |                |       | -  5-Cloud, Data center, or Proxy IP                  |
|               |                |       | -  6-Unsupported Device                               |
|               |                |       | -  7-Blocked App                                      |
|               |                |       | -  8-Unmatched User                                   |
|               |                |       | -  9-Unmatched App                                    |
|               |                |       | -  10-Unmatched posid                                 |
|               |                |       | -  10001-无可投放广告                                 |
|               |                |       | -  10101-流量规则不可用                               |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+


**ads 对象**

+---------------+----------------+-------+-------------------------------------------------------+
| 参数名称      | 类型           | 必须  | 说明                                                  |
+===============+================+=======+=======================================================+
| id            | string         | 否    | 跟踪竞价广告id，SSP 系统生成唯一id                    |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
| cost_type     | int            | 否    | 计费方式 1-cpc, 2-cpm                                 |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
| price         | float          | 否    | 广告出价，单位元；例如 1.23                           |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
| pos_id        | string         | 是    | 广告位 ID                                             |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
| interaction   | int            | 是    | - 广告交互类型                                        |
| _type         |                |       | - 0-NO_INTERACT                                       |
|               |                |       | - 1-SURFING( 打开网页， 默认)                         |
|               |                |       | - 2-DOWNLOAD(下载)                                    |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
| creative      | object         | 是    | 创意元素；广告位广告类型对应具体广告元素，            |
| _elements     |                |       | 见附录“广告位返回广 告元素参照表”                     |
+---------------+----------------+-------+-------------------------------------------------------+
| site_url      | string         | 否    | 推广标的物地址                                        |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
| click         | string         | 否    | 点击地址（监控）。                                    |
| _tracking_url |                |       |                                                       |
|               |                |       | 注：如果site_url、click_url 同时存在，点击响应        |
|               |                |       | 地址为click_url                                       |
|               |                |       |                                                       |
|               |                |       | * 格式请参考附录"6. 展示、点击监测对接URL" *          |
+---------------+----------------+-------+-------------------------------------------------------+
| imp           | array          | 否    | 曝光监控地址                                          |
| _tracking_url |                |       |                                                       |
|               |                |       |                                                       |
|               |                |       | * 格式请参考附录"6. 展示、点击监测对接URL" *          |
+---------------+----------------+-------+-------------------------------------------------------+



**creative_elements 对象**

+---------------+----------------+-------+-------------------------------------------------------+
| 参数名称      | 类型           | 必须  | 说明                                                  |
+===============+================+=======+=======================================================+
|corporate_name | string         | 否    | 商标名称                                              |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
|corporate_img  | string         | 否    | 商标，图片url                                         |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
|image          | string         | 否    | 图片1 url                                             |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
|image2         | string         | 否    | 图片2 url                                             |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
|image3         | string         | 否    | 图片3 url                                             |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
|title          | string         | 否    | 广告文案                                              |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
|description    | string         | 否    | 广告描述                                              |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+
|video          | string         | 否    | VIDEO url                                             |
|               |                |       |                                                       |
+---------------+----------------+-------+-------------------------------------------------------+



展示、点击监测对接API
-----------------------------------------
适用于合作的移动媒体，对于投放过程中的监测服务，格式如下:

**点击监测**
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
http://mmptr.wa.sbox.limei.com/mtx/c?id=90826883437541799



**展⽰监测**
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
http://mmptr.wa.sbox.limei.com/at/i?id=908268834375417992
http://mmptr.wa.sbox.limei.com/mtx/i?id=908268834375417992


附录
-----------------------------------------
**广告位返回广告元素参照表**
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


+---------------+-------------------------------------+-------------------------------------------+
| 广告位类型    | 规格名称                            | 支持创意元素                              |
+===============+=====================================+===========================================+
| 1-横幅        |                                     | image                                     |
+---------------+-------------------------------------+-------------------------------------------+
| 2-插屏        |                                     | image                                     |
+---------------+-------------------------------------+-------------------------------------------+
| 3-开屏        |                                     | image                                     |
+---------------+-------------------------------------+-------------------------------------------+
|               |商标图、标题、描述、详情图           | corporate_img,title,description,image     |
+               +-------------------------------------+-------------------------------------------+
|               |商标图、标题、描述                   | corporate_img,title,description           |
+               +-------------------------------------+-------------------------------------------+
| 4-原生Feeds   |商标图、标题                         | corporate_img,title                       |
+               +-------------------------------------+-------------------------------------------+
|               |标题、描述、详情图                   | title,description,image                   |
+               +-------------------------------------+-------------------------------------------+
|               |标题、详情图                         | title,image                               |
+               +-------------------------------------+-------------------------------------------+
|               | 3 图、描述                          | image,image2,image3,description           |
+---------------+-------------------------------------+-------------------------------------------+
| 5-原生视频    | 信息流视频，带商标                  | corporate_name,corporate_img,description  |
|               |                                     | ,video                                    |
+               +-------------------------------------+-------------------------------------------+
|               | 正文视频                            | description,video                         |
+---------------+-------------------------------------+-------------------------------------------+
